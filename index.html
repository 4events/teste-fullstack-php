<!doctype html>
<html lang="pt-BR">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">

  <title>:: GetPostCARROS ::</title>
</head>

<body class="bg-light pt-5">

  <nav class="navbar fixed-top navbar-danger bg-danger shadow">
    <div class="container">
      <a class="navbar-brand mx-5 px-5 text-light">GetPostCARROS</a>
      <form class="d-flex mx-5">
        <input class="form-control form-control-sm rounded-pill me-2" id="src" type="search" placeholder=" Busque um veículo"
          aria-label="Buscar">
      </form>
    </div>
  </nav>

  <div class="container mt-5">
    <div class="row mb-5">
      <div class="col">
        <div class="row justify-content-end">
          <div class="col text-end">
            <p class="h5 text-secondary pt-3">Não encontrou seu veículo? Adicione-o a lista.</p>
          </div>
          <div class="col-auto mx-5">
            <a class="ml-auto h1 text-secondary" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button"
              aria-controls="offcanvasExample">
              <i class="bi bi-plus-circle-fill"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="container-fluid">
    <div class="row">
      <div class="col px-0">
        <div class="accordion accordion-flush bg-white border shadow-sm" id="accordionFlush">
          <div class="container datas-db">

          </div>
        </div>
      </div>
    </div>
  </div>






  <!-- Modal -->
  <div class="modal fade bg-danger" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered text-center bg-transparent">
      <div class="modal-content bg-transparent">
        <div class="modal-body bg-transparent">
          <p class="text-light">Carro salvo com sucesso . </p>
          <div class="spinner-grow text-light" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title text-danger" id="offcanvasExampleLabel">Novo Cadastro</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <form class="row g-3 validation-ok">
        <div class="col-12 mt-0">
          <hr class="text-secondary mb-4">
          <label for="validaMod" class="form-label">Modelo:</label>
          <input type="text" class="form-control rounded-pill" id="validaMod" required>
        </div>
        <div class="col-12">
          <label for="validaFab" class="form-label">Fabricante:</label>
          <input type="text" class="form-control rounded-pill" id="validaFab" required>
        </div>
        <div class="col-12">
          <label for="validaDesc" class="form-label">Descrição:</label>
          <textarea type="textarea" class="form-control rounded" id="validaDesc" rows="4" required></textarea>
        </div>
        <div class="col-12">
          <label for="validaAno" class="form-label">Ano:</label>
          <input type="text" class="form-control rounded-pill" id="validaAno" required>
        </div>
        <div class="col-12">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="validVend" name="validVend" value="0">
            <label class="form-check-label" for="validVend">
              Marcar como vendido
            </label>
          </div>
        </div>
        <div class="invalid-feedback d-block text-center mt-2">
          Para realizar cadastros é obrigatório preencher todos os campos!
        </div>
        <div class="col-12 mt-3">
          <button id="cadB" class="btn btn-danger w-100 rounded-pill" type="button">Realizar Cadastro</button>
        </div>
      </form>
    </div>
  </div>


  <footer class="footer mt-5">
    <div class="container">
      <p class="text-center text-muted small">
        GetPostCARROS - 2021
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script>
    $(document).ready(function(){
        let countR = 0;
        $.ajax({url: "http://localhost:9502/veiculos", success: function(result){
          result.forEach(function(item){
            countR++;
            $(".datas-db").append( 
              '<div class="accordion-item data-db">'+
                '<h5 class="accordion-header px-5 py-3" id="flush-heading'+countR+'">'+
                  '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"'+
                    'data-bs-target="#flush-collapse'+countR+'" aria-expanded="false" aria-controls="flush-collapse'+countR+'">'+
                    '<div class="row justify-content-between">'+
                      '<div class="col-auto">'+
                        'Modelo: <span class="text-muted">'+item.modelo+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Fabricante: <span class="text-muted">'+item.modelo+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Ano: <span class="text-muted">'+item.ano+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Vendido: <span class="text-muted">'+( item.vendido == 1 ? "Sim" : "não" )+'</span>'+
                      '</div>'+
                    '</div>'+
                  '</button>'+
                '</h2>'+
                '<div id="flush-collapse'+countR+'" class="accordion-collapse collapse bg-light rounded-bottom border shadow-sm  px-5 py-1 mx-5 mb-3" aria-labelledby="flush-heading'+countR+'"'+
                  'data-bs-parent="#accordionFlush">'+
                    '<div class="row justify-content-start p-4">'+
                      '<div class="col-auto">'+
                        'Descricao: <br> <span class="text-muted">'+item.descricao+'</span>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'
            );
          });
        }});

      $("#src").keyup(function(){
        let countR = 0;
        $.ajax({url: "http://localhost:9502/veiculos/find?q="+$("#src").val(), success: function(result){
          $(".data-db").remove();
          if (result.err == "03"){
            $(".datas-db").append( 
              '<div class="accordion-item data-db">'+
                '<h5 class="text-center p-5">'+
                  '<span class="text-muted">'+result.msg+'</span>'+
                '</h5>'+
              '</div>'
            );
            return false;
          }
          result.forEach(function(item){
            countR++;
            $(".datas-db").append( 
              '<div class="accordion-item data-db">'+
                '<h5 class="accordion-header px-5 py-3" id="flush-heading'+countR+'">'+
                  '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"'+
                    'data-bs-target="#flush-collapse'+countR+'" aria-expanded="false" aria-controls="flush-collapse'+countR+'">'+
                    '<div class="row justify-content-between">'+
                      '<div class="col-auto">'+
                        'Modelo: <span class="text-muted">'+item.modelo+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Fabricante: <span class="text-muted">'+item.modelo+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Ano: <span class="text-muted">'+item.ano+'</span>'+
                      '</div>'+
                      '<div class="col-auto">'+
                        'Vendido: <span class="text-muted">'+( item.vendido == 1 ? "Sim" : "não" )+'</span>'+
                      '</div>'+
                    '</div>'+
                  '</button>'+
                '</h2>'+
                '<div id="flush-collapse'+countR+'" class="accordion-collapse collapse bg-light rounded-bottom border shadow-sm  px-5 py-1 mx-5 mb-3" aria-labelledby="flush-heading'+countR+'"'+
                  'data-bs-parent="#accordionFlush">'+
                    '<div class="row justify-content-start p-4">'+
                      '<div class="col-auto">'+
                        'Descricao: <br> <span class="text-muted">'+item.descricao+'</span>'+
                      '</div>'+
                    '</div>'+
                '</div>'+
              '</div>'
            );
          });
        }});
      });
    });

    $('#cadB').click(function(){
      var forms = document.querySelectorAll('.validation-ok');
      Array.prototype.slice.call(forms).forEach(function (form){
        if (!form.checkValidity()) {
          form.classList.add('was-validated');
        }else{
          form.classList.remove('was-validated');
          let choices = [];
          let es = document.getElementsByName('validVend');
          for (let i=0;i<es.length;i++){
            if ( es[i].checked ) {
              choices.push(es[i].value);
            }
          }
          let varbody = {
              ano: $("#validaAno").val(),
              modelo: $("#validaMod").val(),
              fabricante: $("#validaFab").val(),
              descricao: $("#validaDesc").val(),
              vendido: (choices[0] === undefined ? "0" : "1")
          };
          $.post("http://localhost:9502/veiculos", JSON.stringify(varbody), function(result){
            $('#staticBackdrop').modal('show');
            setTimeout(() => {document.location.reload(true);}, 4000);            
          });
        }
      })
    });
  </script>
</body>

</html>
